var app=angular.module("labResults",["ngRoute"]);app.config(["$routeProvider","$locationProvider",function(a,b){a.when("/",{templateUrl:"views/login.html",controller:"loginController"}).when("/register",{templateUrl:"views/register.html",controller:"registerController"}).when("/login",{templateUrl:"views/login.html",controller:"loginController"}).when("/patientDashboard",{templateUrl:"views/patientDashboard.html",controller:"patientDashboardController"}).when("/doctorDashboard",{templateUrl:"views/doctorDashboard.html",controller:"doctorDashboardController"}),b.html5Mode(!0)}]),app.controller("loginController",["$scope","$http","$location","AuthService",function(a,b,c,d){var e={};a.title="Login Page",a.login=function(){e=a.user,d.login(e).then(function(){var a=d.getUserStatus();console.log("logged in?",d.isLoggedIn()),console.log("patient flag?",a.patientflag),a.patientflag&&d.isLoggedIn?c.path("patientDashboard"):a.doctorflag&&d.isLoggedIn&&c.path("doctorDashboard")}).then(function(){console.log("user info",d.getUserStatus())})},a.registrationRedirect=function(){console.log("clicked!"),c.path("register")}}]),app.controller("registerController",["$scope","$http","$location",function(a,b,c){var d={};a.title="Registration Page",a.register=function(){d=a.user,console.log(d),b.post("/register",this.user).then(function(a){a.data?"error"==a.data.name?alert("This username already exists. Please pick a new one."):(alert("Your account has been created. Please log in on the next screen."),c.path("")):console.log("error")})},a.loginRedirect=function(){c.path("")}}]),app.controller("patientDashboardController",["$scope","$http","$location","anchorSmoothScroll","AuthService",function(a,b,c,d,e){a.currentUser=e.getUserStatus(),console.log("dashboard user",a.currentUser),a.logout=function(){e.logout(),c.path("")},a.goTo=function(a){d.scrollTo(a)}}]),app.controller("doctorDashboardController",["$scope","$http","$location","anchorSmoothScroll","AuthService",function(a,b,c,d,e){function f(){b.get("/doctorDashboard/doctorList").then(function(b){console.log("doctor list:",b),a.doctorList=b.data})}a.createDoctor=!1,a.doctorList=[],console.log(a.createDoctor),a.currentUser=e.getUserStatus(),a.currentUser.adminflag&&(a.admin=!0),a.createDoctor=function(){var b=a.doctor;console.log(b)},a.logout=function(){e.logout(),c.path("")},a.goTo=function(a){d.scrollTo(a)},f()}]),app.factory("AuthService",["$q","$timeout","$http",function(a,b,c){function d(){return console.log("userInfo hit"),user}function e(){return null!=k}function f(){return console.log(j),j}function g(b){console.log("login service hit");var d=a.defer();return c.post("/login",b).success(function(a,c){200===c?(console.log("success"),k=!0,console.log("data",a.id),j=a,console.log("user in service",b),d.resolve()):(console.log(a),console.log("error in success"),k=!1,b=null,d.reject())}).error(function(a){console.log("error in error"),k=!1,b=null,d.reject()}),d.promise}function h(){j={},e=!1,console.log(j);var b=a.defer();return b.promise}function i(b){var d=a.defer();return c.post("/register",b).success(function(a,b){200===b?(alert("Your account has been created. Please log in on the next screen."),$location.path(),d.resolve()):(alert("This username already exists. Please pick a new one."),d.reject())}).error(function(a){d.reject()}),d.promise}var j,k=null;return{isLoggedIn:e,getUserStatus:f,login:g,logout:h,register:i,userInfo:d,User:j}}]),app.service("anchorSmoothScroll",function(){this.scrollTo=function(a){function b(){return self.pageYOffset?self.pageYOffset:document.documentElement&&document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop?document.body.scrollTop:0}function c(a){for(var b=document.getElementById(a),c=b.offsetTop,d=b;d.offsetParent&&d.offsetParent!=document.body;)d=d.offsetParent,c+=d.offsetTop;return c}var d=b(),e=c(a),f=e>d?e-d:d-e;if(f<100)return void scrollTo(0,e);var g=Math.round(f/20);g>=20&&(g=20);var h=Math.round(f/25),i=e>d?d+h:d-h,j=0;if(e>d)for(var k=d;k<e;k+=h)setTimeout("window.scrollTo(0, "+i+")",j*g),i+=h,i>e&&(i=e),j++;else for(var k=d;k>e;k-=h)setTimeout("window.scrollTo(0, "+i+")",j*g),i-=h,i<e&&(i=e),j++}});